<%
  field_keys ||= []
  name = field_tag_name formObject, text_field, field_keys
  field_id = "#{text_field.form.name.dehumanize}_#{sanitize_to_id name}"
  should_default =
    (defined?(is_subform) && is_subform) ||
    (defined?(is_modal_subform) && is_modal_subform) ||
    formObject.new_record?
  value = text_field.selected_value if text_field.selected_value.present? && should_default
  value ||= formObject.new_record? && ((field_id.include?('child_helpline_form_child_reported_by') && current_user.roles.map(&:name).include?('CP - Helpline Operator')) || (field_id.include?('user_providing_response') && current_user.roles.map(&:name).include?('Referral'))) ? current_user.user_name : field_value(formObject, text_field, field_keys)
  show_hide_text_link = text_field.hidden_text_field && !formObject.new_record?
  hide_text_link_text = formObject.hidden_name ? I18n.t("cases.view_name") : I18n.t("cases.hide_name")
  hide_text_link_action = formObject.hidden_name ? "view" : "protect"
  value = I18n.t("cases.hidden_text_field_text") if text_field.hidden_text_field && formObject.hidden_name && !formObject.new_record?
  is_disabled = (text_field.hidden_text_field && formObject.hidden_name && !formObject.new_record?) || text_field.disabled
  field_tags = text_field.field_tags.present? ? text_field.field_tags : []
  disable = (defined?(is_subform) && is_subform) ? true : is_disabled
  validator = is_phone_field?(field_id) ? "primeroContactNo" : ''
%>
<div class="row">
  <div class="medium-4 columns">
    <span class="tool-tip-label">
      <%= label_tag field_id, text_field.display_name, :class=>'key inline' %>
    </span>
  </div>
  <div class="medium-8 columns">
    <% if text_field.required %><span class="required form-section-required">*</span><% end %>
    <%= text_field_tag name, value, :disabled => disable, :disabled_by_form => text_field.disabled, :is_disabled  => is_disabled, :id => field_id, :data => { :field_tags => field_tags }, "data-validator" => validator, required: text_field.required, :"data-abide-ignore" => (!text_field.required || (defined?(is_subform) && is_subform)) && !is_phone_field?(field_id) ? "" : nil %>
    <small class="form-error">
      <%= "Invalid Phone Number. minimum 7 and maximum 11 digits only" if is_phone_field?(field_id) %>
    </small>
    <%= link_to(hide_text_link_text, hide_text_link_text.dehumanize, :class => "hidden_text_field",
        :action => hide_text_link_action) if show_hide_text_link %>
    <% if text_field.hidden_text_field && formObject.new_record? %>
      <%= check_box_tag "#{formObject.class.name.underscore.downcase}[hidden_name]", true, false %>
      <%= label_tag "#{formObject.class.name.underscore.downcase}[hidden_name]", hide_text_link_text %>
    <% end %>
    <% if text_field.help_text || is_phone_field?(field_id) %><p class="help"><%= is_phone_field?(field_id) ? "You can enter minimum 7 and maximum 11 digits only. Starting the number with '0' i.e. Zero" : text_field.help_text %></p><% end %>
    <% if text_field.guiding_questions.present? %>
      <%= render 'form_section/guiding_questions', guiding_questions_text: text_field.guiding_questions %>
    <% end %>
  </div>
</div>
